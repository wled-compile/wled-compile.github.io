<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="copyright" content="&copy; 2023 Wladislaw Waag" />
  <title>WLED Online compiler</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <link rel="stylesheet" href="index.css">
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<div class="container">
<h3 style="font-weight: bold;"><span style="color:red">W</span><span style="color:orange">L</span><span style="color:darkblue">E</span><span style="color:lightpink">D</span><span style="color:mediumblue"> o</span><span style="color:brown">n</span><span style="color:hotpink">l</span><span style="color:lightcoral">i</span><span style="color:red">n</span><span style="color:seagreen">e</span><span style="color:crimson"> c</span><span style="color:darkgreen">o</span><span style="color:darkmagemnta">m</span><span style="color:darkblue">p</span><span style="color:red">i</span><span style="color:darksalmon">l</span><span style="color:lightpink">e</span><span style="color:red">r</span></h3>
	<div class="form-floating mb-1">
	  <select id="lang" onchange="LangChanged();" class="form-select" aria-label="" style="min-width: 200px; width:auto;">
			<option value="0">Deutsch</option>
			<option value="1">English</option>
	  </select>
	  <label for="lang">Language/Sprache:</label>
	</div>
	<div class="form-floating mb-1">
		<h4 id="L07">Kompiliere Dir eigene WLED Software online mit nur wenigen Klicks!</h4>
		<p><span id="L25">(alter compile helper hier: </span><a href="./index1.html">old compile helper</a>)</p>
	</div>
	<div class="form-floating mb-1">
		<p><span id="L35" style="color:red">Achtung: bitte geben Sie bei der Konfiguration der WLED SW keine personenbezogenen Daten (Name etc.) und keine geheimen Informationen (Passwörter etc.) ein! Das kompilieren erfolgt auf öffentlich zugänglichen Servern, so dass jeder die von Ihnen eingegebenen Informationen einsehen kann!</p>
	</div>
	<div class="accordion accordion-flush" id="MainAccordion">
	<div class="accordion-item">
	<h2 class="accordion-header" id="headingMainDetails1">
	  <button class="accordion-button collapsed" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne1" aria-expanded="true" aria-controls="collapseOne1">
		<span id="L30" style="color:blue;text-decoration: underline;">Schritt 1: WLED Software / Release / Controller-Typ auswählen</span>
	  </button>
	</h2>
	<div id="collapseOne1" class="accordion-collapse collapse" aria-labelledby="headingMainDetails1" data-bs-parent="#MainAccordion">
	<div class="accordion-body">
	<div class="row row-cols-auto">
		<div class="col mb-1">
		  <div class="form-floating">
			<select id="select-sources" onchange="SourceChanged();" class="form-select" aria-label="" style="min-width: 20em; width:auto;"></select>
			<label for="select-sources"><span id="L01">Quelle der WLED SW auswählen (Abzweigung):</span></label>
		  </div>
		</div>
		<div class="col mb-1">
		  <div class="form-floating">
			<select id="select-branches" onchange="BranchChanged();" class="form-select" aria-label="" style="min-width: 20em; width:auto;"></select>
			<label for="select-branches"><span id="L02">Branch / Release auswählen</span></label>
		  </div>
		</div>
		<div class="col mb-1">
		  <div class="form-floating">
			<select id="select-enviroments" onchange="EnvChanged();" class="form-select" aria-label="" style="min-width: 20em; width:auto;" ></select>
			<label for="select-enviroments"><span id="L03">Mikrocontroller Typ auswählen:</span></label>
		  </div>
		</div>
	</div>
	<div class="row row-cols-auto" id="UserInputRow">
		<div class="col mb-1">
		  <div class="form-floating">
			<input id="input-username" onchange="UserRepoChanged();" class="form-control" aria-label="" style="min-width: 20em; width:auto;"></select>
			<label for="input-username"><span id="L26">Your GitHub user name:</span></label>
		  </div>
		</div>
		<div class="col mb-1">
		  <div class="form-floating">
			<input id="input-reponame" onchange="UserRepoChanged();" class="form-control" aria-label="" style="min-width: 20em; width:auto;"></select>
			<label for="input-reponame"><span id="L27">Your GitHub repository:</span></label>
		  </div>
		</div>
	</div>
	
	<div class="accordion accordion-flush border border-secondary" id="SecAcc"><div class="accordion-item">
	
	<h2 class="accordion-header" id="headingSecDetails1">
	  <button class="accordion-button collapsed" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSec1" aria-expanded="true" aria-controls="collapseSec1">
		<span id="L39" style="color:blue;text-decoration: underline;">Information about the selected controller type definitions:</span>
	  </button>
	</h2>
	<div id="collapseSec1" class="accordion-collapse collapse" aria-labelledby="headingSecDetails1" data-bs-parent="#SecAcc">
	<div class="accordion-body">
	<div class="row"><div class="col">
		<div id="PioEnvInfoText"></div>
	</div></div>
	</div></div>
	</div>
	</div>
	
	</div>
	</div>
	</div>
	
	<div class="accordion-item">
	<h2 class="accordion-header" id="headingMainDetails1a">
	  <button class="accordion-button collapsed" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne1a" aria-expanded="true" aria-controls="collapseOne1a">
		<span id="L30a" style="color:blue;text-decoration: underline;"> Schritt 1a: Modifikationen</span>
	  </button>
	</h2>
	<div id="collapseOne1a" class="accordion-collapse collapse" aria-labelledby="headingMainDetails1a" data-bs-parent="#MainAccordion">
	<div class="accordion-body">
	<div id="div-details">
		
	</div>
	</div>
	</div>
	</div>
	
	
	<div class="accordion-item">
	<h2 class="accordion-header" id="headingMainDetails1b">
	  <button class="accordion-button collapsed" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne1b" aria-expanded="true" aria-controls="collapseOne1b">
		<span id="L30b" style="color:blue;text-decoration: underline;"> Schritt 1b: Hacks & tweaks</span>
	  </button>
	</h2>
	<div id="collapseOne1b" class="accordion-collapse collapse" aria-labelledby="headingMainDetails1b" data-bs-parent="#MainAccordion">
	<div class="accordion-body">
	<div id="div-hacks">
		
	</div>
	</div>
	</div>
	</div>
	
	<div class="accordion-item">
	<h2 class="accordion-header" id="headingMainDetails2">
	  <button class="accordion-button collapsed" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne2" aria-expanded="true" aria-controls="collapseOne2">
		<span id="L31" style="color:blue;text-decoration: underline;"> Schritt 2: Optionen auswählen</span>
	  </button>
	</h2>
	<div id="collapseOne2" class="accordion-collapse collapse" aria-labelledby="headingMainDetails2" data-bs-parent="#MainAccordion">
	<div class="accordion-body">
	<div id="div-options">
		
	</div>
	</div>
	</div>
	</div>
	
	<div class="accordion-item">
	<h2 class="accordion-header" id="headingMainDetails3">
	  <button class="accordion-button collapsed" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne3" aria-expanded="true" aria-controls="collapseOne3">
		<span id="L32" style="color:blue;text-decoration: underline;"> Schritt 3: UserMods auswählen</span>
	  </button>
	</h2>
	<div id="collapseOne3" class="accordion-collapse collapse" aria-labelledby="headingMainDetails3" data-bs-parent="#MainAccordion">
	<div class="accordion-body">
	<div id="div-usermods">
		
	</div>
	</div>
	</div>
	</div>
	
	<div class="accordion-item">
	<h2 class="accordion-header" id="headingMainDetails4">
	  <button class="accordion-button collapsed" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne4" aria-expanded="true" aria-controls="collapseOne4">
		<span id="L06" style="color:blue;text-decoration: underline;"> Schritt 4: Prüfe generierte Konfiguration (ignoriere, wenn Du nicht weiss was das ist)</span>
	  </button>
	</h2>
	<div id="collapseOne4" class="accordion-collapse collapse" aria-labelledby="headingMainDetails4" data-bs-parent="#MainAccordion">
	<div class="accordion-body">
	<div class="input-group">
	  <span class="input-group-text"></span>
	  <textarea class="form-control" rows="5" id="env-text"></textarea>
	</div>
	</div>
	</div>
	</div>
	<div class="accordion-item">
	<h2 class="accordion-header" id="headingMainDetails5">
	  <button class="accordion-button collapsed" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne5" aria-expanded="true" aria-controls="collapseOne5">
		<span id="L33" style="color:blue;text-decoration: underline;"> Schritt 5: Kompilieren starten und nach Abschluss SW herunterladen</span>
	  </button>
	</h2>
	<div id="collapseOne5" class="accordion-collapse collapse" aria-labelledby="headingMainDetails5" data-bs-parent="#MainAccordion">
	<div class="accordion-body">
	<div class="container m-0 p-2">
	<button type="button" class="btn btn-primary" onclick="StartBuildOnline()"><span span id="L22">Kompilieren starten</span></button>
	<a id="downloadLinkYAML" href="" download="wled_compile.yaml" style="display: none;"></a>
	
	<div class="container m-0 p-2">
	<div class="row row-cols-auto">
	  <div class="col mb-1">
		<h5><span id="L34">Ergebnisse</span></h5>
	  </div>
	  <div class="col mb-1">
		<div class="spinner-border text-primary" role="status" id="spinner"></div>
	  </div>
	</div>
	<p id="result_line1"></p>
	<p id="result_line2"></p>
	<p id="result_line3"></p>
	<div><small id="L36">Diese Software ist open source und wird kostenfrei zur Verfügung gestellt. Es werden keine bestimmten Eigenschaften der Software zugesichert. Der Inhaber dieser Webseite haftet nur für Vorsatz und grobe Fahrlässigkeit. Gewährleistungspflichten treffen ihn nur, wenn er Mängel der Software arglistig verschwiegen hat.</small></div>
    <div><small id="L37">Bitte beachten Sie die Software Lizenzen: <a href="https://wled-install.github.io/WLED_Software_Lizenzen.pdf">WLED licenses</a></small></div>
	</div>
	
    </div>
	</div>
	</div>
	</div>
	

	<div class="accordion-item">
	<h2 class="accordion-header" id="headingMainDetails6">
	  <button class="accordion-button collapsed" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne6" aria-expanded="true" aria-controls="collapseOne6">
		<span id="L38" style="color:blue;text-decoration: underline;">Schritt 6: Kompilierte SW direkt über USB installieren</span>
	  </button>
	</h2>
	<div id="collapseOne6" class="accordion-collapse collapse" aria-labelledby="headingMainDetails6" data-bs-parent="#MainAccordion">
	<div class="accordion-body">
	<div class="container m-0 p-2">
	<div id="InstallNoteContainer">	
	</div>
	<div id="InstallContainer">
	<h5 id="L23x">Vorgehensweise:</h5>
      <ol>
          <li><span id="L01x">Schliessen Sie Ihr ESP8266 / ESP32 / ESP32-xy Board an USB an.</span></li>
          <div></div>
          <li><span id="L03x">Klicken Sie auf "Installieren" und wählen dann den korrekten COM-Port aus. </span><u><a onclick="NoComPortHelp()" class="btn btn-secondary btn-sm"><span id="L04x">Kein Board wurde gefunden?</span></a></u></li>
          <div id="comporthelp"></div>
          <li><span id="L05x">Klicken Sie auf "Install WLED". Die Installation beginnt. Sollte nach einiger Zeit die Installation beim "Wrapping Up" stehen bleiben, können es es unterbrechen. Die SW ist dann trotzdem i.O. installiert.</span></li>
      	  <li><span id="L27x">Wichtige Hinweise zu neuen Controller-Typen: </span><u><a onclick="NewTypesHelp()" class="btn btn-secondary btn-sm"><span>ESP32-C3, ESP32-S2, ESP32-S3, ESP32-C6 etc.</span></a></u></li>
          <div id="newtypeshelp"></div>
	  <li><span id="L28x">ESP32-S2: aktuell nicht möglich. </span></li>
          <div id="newtypeshelp"></div>
      </ol>
	   <div id="ButtonContainer">
		<div class="container inst-button">
          <esp-web-install-button id="install_btn" manifest="manifest_file.json" >
            <button class="btn btn-primary" slot="activate" id="InstallButton"><span id="L09x">Installieren</span></button>
          </esp-web-install-button>
		</div>
	   </div>
	</div>
    </div>
	</div>
	</div>
	</div>

	
	</div>
<hr>
    <div class="container">
	   <div class="row">
		<div class="col-md">
				<h5 id="L14">Nützliche Informationen:</h5>
				<ul>
				  <li><span id="L14a">Offizielle WLED Wiki (Englisch):</span> <a href="https://kno.wled.ge">https://kno.wled.ge</a></li>
				  <li><span id="L14f">WLED FAQ: <a href="https://wled-faq.github.io">https://wled-faq.github.io</a></span></li>
				  <li><span id="L14c">Professionelle WLED Boards:<a href="https://shop.myhome-control.de">MyHome-Control Shop</a></span></li>
				  <li><span id="L14d">WEB-based WLED software installer:</span> <a href="https://wled-install.github.io">WLED-INSTALL</a></li>
				  <li><span id="L14e">WLED power calculator: </span><a href="https://wled-calculator.github.io">https://wled-calculator.github.io</a></li>
				</ul>
		</div>
	   <div class="col-md">
	   
			<div id="carousel1" class="carousel carousel-dark slide img-fluid" data-bs-ride="carousel" data-bs-interval="7000">
			  <div class="carousel-indicators">
				<button type="button" data-bs-target="#carousel1" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
				<button type="button" data-bs-target="#carousel1" data-bs-slide-to="1" aria-label="Slide 2"></button>
				<button type="button" data-bs-target="#carousel1" data-bs-slide-to="2" aria-label="Slide 3"></button>
				<button type="button" data-bs-target="#carousel1" data-bs-slide-to="3" aria-label="Slide 4"></button>
			  </div>
			  <div class="carousel-inner">
				<div class="carousel-item active">
				 <a target="_blank" href="https://shop.myhome-control.de">
				  <img src="pictures/werbung1.jpg" class="d-block w-100" alt="WLED Controller Board V43">
				 </a> 
				</div>
				<div class="carousel-item">
				  <a target="_blank" href="https://shop.myhome-control.de">
				  <img src="pictures/werbung2.jpg" class="d-block w-100" alt="WLED Controller Board mini V73">
				 </a> 
				</div>
				<div class="carousel-item">
				  <a target="_blank" href="https://shop.myhome-control.de">
				  <img src="pictures/werbung3.jpg" class="d-block w-100" alt="WLED LineIn-to-I2S Adapter">
				 </a> 
				</div>
				<div class="carousel-item">
				  <a target="_blank" href="https://shop.myhome-control.de">
				  <img src="pictures/werbung4.jpg" class="d-block w-100" alt="WLED Ethernet Adapter for WLED Controller V43">
				 </a> 
				</div>
			  </div>
			  <button class="carousel-control-prev" type="button" data-bs-target="#carousel1" data-bs-slide="prev">
				<span class="carousel-control-prev-icon" aria-hidden="true"></span>
				<span class="visually-hidden">Previous</span>
			  </button>
			  <button class="carousel-control-next" type="button" data-bs-target="#carousel1" data-bs-slide="next">
				<span class="carousel-control-next-icon" aria-hidden="true"></span>
				<span class="visually-hidden">Next</span>
			  </button>
			</div>
	   
	   </div>
	  </div>
    </div>
	  
<div class="container">
   <div class="accordion accordion-flush bottompart" id="accordionBottom">
		<div class="accordion-item">
			<h4 class="accordion-header" id="headingImprint">
			  <button class="accordion-button collapsed bottompart" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseImprint" aria-expanded="true" aria-controls="collapseOne">
				<span id="L18" style="color:blue;text-decoration: underline;">Impressum</span>
			  </button>
			</h4>
			<div id="collapseImprint" class="accordion-collapse collapse bottompart" aria-labelledby="headingImprint" data-bs-parent="#accordionBottom">
			  <div class="accordion-body bottompart">
				<small><span id="L19"><br><h3>Impressum</h3>Verantwortlicher: Wladislaw Waag<br>Adresse: Wasserburger Landstr. 29, 81825 München, Deutschland<br>Kontakt: +49 (0) 176 47 11 5206, info@myhome-control.de<br><br>EU-Streitschlichtung: Die Europäische Kommission stellt eine Plattform zur Online-Streitbeilegung (OS) bereit: <a href='https://ec.europa.eu/consumers/odr/' target='_blank'>https://ec.europa.eu/consumers/odr/</a>.<br><br>Verbraucherstreitbeilegung/Universalschlichtungsstelle: Wir sind nicht bereit oder verpflichtet, an Streitbeilegungsverfahren vor einer Verbraucherschlichtungsstelle teilzunehmen.</span></small>
			  </div>
			</div>
		</div>
		
		<div class="accordion-item bottompart">
			<h4 class="accordion-header bottompart" id="headingPrivacy">
			  <button class="accordion-button collapsed bottompart" style="padding-left:0;" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePrivacy" aria-expanded="true" aria-controls="collapseOne">
				<span id="L20" style="color:blue;text-decoration: underline;">Datenschutzerklärung</span>
			  </button>
			</h4>
			<div id="collapsePrivacy" class="accordion-collapse collapse bottompart" aria-labelledby="headingPrivacy" data-bs-parent="#accordionBottom">
			  <div class="accordion-body bottompart">
				<small><span id="L21"><br><h3>Datenschutzerklärung</h3> Diese Seite wird im Rahmen von 'Github Pages' gehostet und betrieben. Es ist möglich und wahrscheinlich, dass Github Ihre personenbezogenen Daten sammelt und verarbeitet. Das betrifft dann auch die Besucher der Webseite wled-compile.github.io. Wir haben aber keinerlei Einfluss darauf. Bitte lesen Sie dazu die Datenschutzerklärung von Github: <a href='https://docs.github.com/en/github/site-policy/github-privacy-statement' target='_blank'>https://docs.github.com/en/github/site-policy/github-privacy-statement</a><br><br>Außerdem sobald Sie mit Kompilieren starten, werden Ihre IP Adresse sowie alle von Ihnen eingegebenen Daten an https://myhome-control.de weitergeleitet. Das ist für die Ausführung des Auftrags zwingend notwendig. Die Datenschutzerklärung dazu finden Sie unter <a href=‘https://shop.myhome-control.de/Information/Datenschutz/‘>https://shop.myhome-control.de/Information/Datenschutz/</a><br><br>Unsere Webseite enthält Links zu externen Webseiten Dritter, auf deren Inhalte wir keinen Einfluss haben. Für diese fremden Inhalte können wir keine Gewähr und keine Haftung übernehmen. Für die Inhalte der verlinkten Seiten ist immer der jeweilige Anbieter oder Betreiber der Seiten verantwortlich. Die verlinkten Seiten wurden zum Zeitpunkt der Verlinkung auf mögliche Rechtsverstöße überprüft. Rechtswidrige Inhalte waren dabei nicht erkennbar. Sollten uns Rechtsverletzungen bekannt werden, werden wir die entsprechende Verlinkung umgehend entfernen.</span></small>
			  </div>
			</div>
		</div>
	  </div>
</div>
</div>
<script>
var dataset;
var selected_ini_lines="";


function proceed_extends(obj) {
	retval=false;
	for(var key of Object.keys(obj)) {
		if (typeof obj[key] === 'object' && !Array.isArray(obj[key]) && obj[key] !== null && ("extends" in obj[key]) && (((obj[key]["extends"] in obj) && !("extends" in obj[obj[key]["extends"]])) || (("env:"+obj[key]["extends"] in obj) && !("extends" in obj["env:"+obj[key]["extends"]]) )) ) {
			// obj[key] uses extends
			// obj[key]["extends"] is the referenced one
			console.log(key+ " USES " + obj[key]["extends"]);
			retval=true;
			ref="";
			if("env:"+obj[key]["extends"] in obj) {
				ref="env:"+obj[key]["extends"];
			} else {
				ref=obj[key]["extends"];
			}
			obj[key]["extends_proceeded"]=obj[key]["extends"];
			//obj[key]["extends_proceeded"] = obj[key]["extends_proceeded"]+" -> "+ref;
			
			if("extends_proceeded" in obj[ref]) obj[key]["extends_proceeded"] = obj[key]["extends_proceeded"]+" -> "+obj[ref]["extends_proceeded"];
			
			// for each subobject in referenced object
			for(var key1 of Object.keys(obj[ref])) {
				// if not exist, copy from referenced one
				if( !(key1 in obj[key])) {
					obj[key][key1]=obj[ref][key1];
				}
			}
			delete obj[key]["extends"];
		}
	}
	console.log("ONE TURN ###############################################");
	console.log(obj);
	return retval;
}

function proceed_dollar_includes(obj) {
	retval=false;
	for(var key of Object.keys(obj)) {
		if (typeof obj[key] === 'object' && !Array.isArray(obj[key]) && obj[key] !== null) {
			//
			obj1=obj[key];
			for(var key1 of Object.keys(obj1)) {
				if (typeof obj1[key1] === 'string' || obj1[key1] instanceof String) {
					regexp1=/\${[^}]*\.[^}]*}/g;
					var match_arr = obj1[key1].match(regexp1);
					if (match_arr!=null) {
						for (const el of match_arr) {
							regexp2=/\${([^}]*)\.([^}]*)}/;
							match = el.match(regexp2);
							// match[1], match[2]
							if(match[1] in obj && match[2] in obj[match[1]]) {
								retval=true;
								//console.log("SBSTITUTE "+el+ " by "+obj[match[1]][match[2]])
								obj[key][key1] = obj[key][key1].replace(el,obj[match[1]][match[2]]);
							}
						}
					}
				}
			}
		}
	}
	//console.log(obj);
	return retval;
}

function TestIni() {
	//pioenvinfo=document.getElementById('PioEnvInfo');
	//pioenvinfo.innerHTML="";
	var value = {};
	var regex = {
		section: /^\s*\[\s*([^\]]*)\s*\]\s*.*$/,
		param: /^\s*([\w\.\-\_]+)\s*=\s*(.*?)\s*$/,
		comment: /^\s*[;#].*$/,
		param_newline: /  (.*?)\s*$/,
		start_with_minus: /^\s*-.*/
	};
	
	if(selected_ini_lines.length>1) {
		last="";
		last_param="";
		
		var section = null;
		lines=selected_ini_lines;
		for(x=0;x<lines.length;x++) {
			line=lines[x].split(';')[0]
			if(regex.comment.test(lines[x])){
				//other
				//console.log(lines[x]);
			}else if(regex.param.test(lines[x]) && !regex.start_with_minus.test(lines[x])){
				var match = lines[x].match(regex.param);
				state="param";
				if(section){
					value[section][match[1]] = match[2].split(';')[0].split(' #')[0].split(/\s*#\s*-.*/)[0].replace(/\s*@\s*/,"@").trim();
				}else{
					value[match[1]] = match[2].split(';')[0].split(' #')[0].split(/\s*#\s*-.*/)[0].replace(/\s*@\s*/,"@").trim();
				}
				last_param=match[1].trim();
			}else if(regex.section.test(lines[x])){
				var match = lines[x].match(regex.section);
				value[match[1]] = {};
				section = match[1].split(';')[0].split(' #')[0].split(/\s*#\s*-.*/)[0].trim();
				last="section";
				last_param="";
			}else if(last_param!="" && regex.param_newline.test(lines[x])){
				//console.log("EXT to "+last_param+": "+lines[x]);
				
				if(section){
					value[section][last_param] = value[section][last_param] + " " + lines[x].split(';')[0].split(' #')[0].split(/\s*#\s*-.*/)[0].replace(/\s*@\s*/,"@").trim();
				}else{
					value[last_param] = value[last_param] + " " +lines[x].split(';')[0].split(' #')[0].split(/\s*#\s*-.*/)[0].replace(/\s*@\s*/,"@").trim();
				}
			}

		}
		while(proceed_dollar_includes(value));
		while(proceed_extends(value));
		//console.log(value);
	}
	return value;
}

function UserRepoChanged() {
	var SS = document.getElementById('select-sources');
	var SI=SS.selectedIndex;
	if(SS.options[SI].getAttribute("custom")==="1") {
		SS.options[SI].setAttribute("ghusername",document.getElementById('input-username').value);
		SS.options[SI].setAttribute("ghreponame",document.getElementById('input-reponame').value);
	}
	SearchForBranchesAndReleases();
}

function SearchForBranchesAndReleases(){
	sel=document.getElementById('select-branches');
	while (sel.options.length > 0) {
        sel.remove(0);
    }
	var opt = document.createElement('option');
    opt.value = 0;
    opt.innerHTML = 'Searching for branches ...';
    sel.appendChild(opt);
	
	sel=document.getElementById('select-enviroments');
	while (sel.options.length > 0) {
        sel.remove(0);
    }
	var opt = document.createElement('option');
    opt.value = 0;
    opt.innerHTML = 'Searching for enviroments in platformio.ini ...';
    sel.appendChild(opt);
	
	var SS = document.getElementById('select-sources');
	var SI=SS.selectedIndex;
	var mReq = new XMLHttpRequest();
	mReq.open('GET', 'https://api.github.com/repos/'+SS.options[SI].getAttribute("ghusername")+'/'+SS.options[SI].getAttribute("ghreponame")+'/branches');
	mReq.responseType = 'json';
	mReq.onreadystatechange = function () {
	  if (this.readyState == 4) {
		if(mReq.status === 200) {
			var SS = document.getElementById('select-sources');
			var SI=SS.selectedIndex;
			sel=document.getElementById('select-branches');
			while (sel.options.length > 0) {
				sel.remove(0);
			}
			var json=this.response;
			for(let i = 0; i < json.length; i++) {
				let obj = json[i];
				var opt = document.createElement('option');
				opt.value = i;
				opt.setAttribute("type","branch");
				opt.setAttribute("bname",obj.name);
				opt.setAttribute("url",'https://github.com/' + SS.options[SI].getAttribute("ghusername") + '/' + SS.options[SI].getAttribute("ghreponame") + '/archive/refs/heads/'+obj.name+'.zip');
				opt.setAttribute("pio_url",'https://raw.githubusercontent.com/' + SS.options[SI].getAttribute("ghusername") + '/' + SS.options[SI].getAttribute("ghreponame") + '/'+obj.name+'/platformio.ini');
				opt.innerHTML = 'Branch: \"'+obj.name+'"';
				if(SS.options[SI].getAttribute("recommendedbranch")===obj.name) {
				opt.innerHTML = opt.innerHTML + ' (RECOMMENDED)';
				
				}
				sel.appendChild(opt);
			}
			// set RECOMMENDED
			for(i = 0; i < sel.options.length; i++) {
			   if (sel.options[i].innerHTML.includes("(RECOMMENDED)")) {
				   sel.value=sel.options[i].value;
			   }
			 }
			
			///////////////////////////////////
			if(SS.options[SI].getAttribute("custom")==="0") {
				var mReq1 = new XMLHttpRequest();
				mReq1.open('GET', 'https://api.github.com/repos/'+SS.options[SI].getAttribute("ghusername")+'/'+SS.options[SI].getAttribute("ghreponame")+'/releases');
				mReq1.responseType = 'json';
				mReq1.onreadystatechange = function () {
				  if (this.readyState == 4) {
					if(mReq1.status === 200) {
						var SS = document.getElementById('select-sources');
						var SI=SS.selectedIndex;
						sel=document.getElementById('select-branches');
						NN=sel.length;
						var json=this.response;
						for(let i = 0; i < json.length; i++) {
							let obj = json[i];
							var opt = document.createElement('option');
							opt.value = i+NN-1;
							opt.setAttribute("type","release");
							opt.setAttribute("bname",obj.tag_name);
							opt.setAttribute("url",obj.zipball_url);
							opt.setAttribute("pio_url",'https://raw.githubusercontent.com/' + SS.options[SI].getAttribute("ghusername") + '/' + SS.options[SI].getAttribute("ghreponame") + '/'+obj.tag_name+'/platformio.ini');
							opt.innerHTML = 'Release: \"'+obj.tag_name+'"';
							sel.appendChild(opt);
						}
						BranchChanged();
					}
				  }
				}	
				mReq1.send();
			} else {
				BranchChanged();
			}
			///////////////////////////////////
			
		}
	  }
	}	
	mReq.send();
}

function SourceChanged() {
	var SS = document.getElementById('select-sources');
	var SI=SS.selectedIndex;
	if(SS.options[SI].getAttribute("custom")==="0") {
		document.getElementById('input-username').value = SS.options[SI].getAttribute("ghusername");
		document.getElementById('input-reponame').value = SS.options[SI].getAttribute("ghreponame");
		document.getElementById('input-username').disabled = true;
		document.getElementById('input-reponame').disabled = true;
	} else {
		document.getElementById('input-username').value = "";
		document.getElementById('input-reponame').value = "";
		document.getElementById('input-username').disabled = false;
		document.getElementById('input-reponame').disabled = false;
	}
	
	SearchForBranchesAndReleases();
}

function BranchChanged() {
	var SB = document.getElementById('select-branches');
	var SI=SB.selectedIndex;
	
	sel=document.getElementById('select-enviroments');
	while (sel.options.length > 0) {
        sel.remove(0);
    }
	selected_ini_lines="";			   
	var opt = document.createElement('option');
    opt.value = 0;
    opt.innerHTML = 'Searching for enviroments in platformio.ini ...';
    sel.appendChild(opt);

	var mReq = new XMLHttpRequest();
	mReq.open('GET', SB.options[SI].getAttribute("pio_url"));
	mReq.responseType = 'plain/text';
	mReq.onreadystatechange = function () {
	  if (this.readyState == 4) {
		if(mReq.status === 200) {
			//console.log(this.response)
			sel=document.getElementById('select-enviroments');
			while (sel.options.length > 0) {
				sel.remove(0);
			}
			splitted=this.response.replaceAll("\r\n","\n").replaceAll("\r","\n").split("\n");
			selected_ini_lines=splitted;				   
			var SS = document.getElementById('select-sources');
			var SSI=SS.selectedIndex;
			for (var i = 0; i < splitted.length; i++) {
				if(splitted[i].replaceAll(" ","").replaceAll("\t","").startsWith("[env:")) {
					envname1=splitted[i].replaceAll(" ","").replaceAll("\t","").replaceAll("[env:","");
					envname=envname1.substr(0, envname1.indexOf(']'));
					if(!(envname.toLowerCase().includes("codm") || envname.toLowerCase().includes("athom") || envname.toLowerCase().includes("travis") || envname.toLowerCase().includes("sp5") || envname.toLowerCase().includes("h803") || envname.toLowerCase().includes("heltec")  || envname.toLowerCase().includes("elekstube") || envname.toLowerCase().includes("anavi") || envname.toLowerCase().includes("my92"))) {
						//console.log(envname);
						var opt = document.createElement('option');
						opt.value = 0;
						opt.innerHTML = envname;
						if(envname===SS.options[SSI].getAttribute("recommended_esp8266")) opt.innerHTML = opt.innerHTML + " (RECOMMENDED for ESP8266)";
						if(envname===SS.options[SSI].getAttribute("recommended_esp32")) opt.innerHTML = opt.innerHTML + " (RECOMMENDED for ESP32)";
						opt.setAttribute("env",envname);
						sel.appendChild(opt);
					}
				}
			}
			EnvChanged();
		}
	  }
	}
	mReq.send();
}

function GetSettingsHtml(setting, DoNotCheckSource, stri) {
	retval="";
	var SS=parseInt(document.getElementById('select-sources').selectedIndex);
	if("value_list" in setting && Object.keys(setting).length>0) {
		retval='<div class="row row-cols-auto"><div class="col mb-1"><div class="form-check"><input class="form-check-input" type="checkbox" id="checkbox-set'+stri+'" name="option-set'+stri+'" value="something" onchange="GenerateEnvText();">  <label class="form-check-label">'+setting.name+'</label></div></div><div class="col mb-1"><select id="input-string-'+stri+'" data-bind="value:input-string-'+stri+'" onchange="GenerateEnvText();" class="form-select" aria-label="" style="min-width: 20em; width:auto;">';
		for(key of Object.keys(setting.value_list)) {
			retval=retval+'<option value="'+key+'">'+key+' ('+setting.value_list[key]+')'+'</option>'
		}		
		retval=retval+'</select></div></div>';
	} else {
	
		if(setting.type=="checkbox" && (DoNotCheckSource || setting.sources.includes(SS))) {
			retval='<div class="row row-cols-auto"><div class="col mb-1"><div class="form-check"><input class="form-check-input" type="checkbox" id="checkbox-set'+stri+'" name="option-set'+stri+'" value="something" onchange="GenerateEnvText();">  <label class="form-check-label">'+setting.name+'</label></div></div></div>';
		}
		if((setting.type=="number" || setting.type=="number_float") && (DoNotCheckSource || setting.sources.includes(SS))) {
			retval='<div class="row row-cols-auto"><div class="col mb-1"><div class="form-check"><input class="form-check-input" type="checkbox" id="checkbox-set'+stri+'" name="option-set'+stri+'" value="something" onchange="GenerateEnvText();">  <label class="form-check-label">'+setting.name+'</label></div></div><div class="col mb-1"><input id="input-number-'+stri+'" type="number" min="-1" data-bind="value:input-number-'+stri+'" onchange="GenerateEnvText();" class="form-control" aria-label="" style="width: 10em;"></div></div>';
		}
		if((setting.type=="string" || setting.type=="defparam") && (DoNotCheckSource || setting.sources.includes(SS))) {
			retval='<div class="row row-cols-auto"><div class="col mb-1"><div class="form-check"><input class="form-check-input" type="checkbox" id="checkbox-set'+stri+'" name="option-set'+stri+'" value="something" onchange="GenerateEnvText();">  <label class="form-check-label">'+setting.name+'</label></div></div><div class="col mb-1"><input id="input-string-'+stri+'" data-bind="value:input-string-'+stri+'" onchange="GenerateEnvText();" class="form-control" aria-label="" style="width: 30em;"></div></div>';
		}
	}
	return retval;
}

function ChangeVisibilityUsermodOptions(i) {
	options_div=document.getElementById('UMOptionsList'+String(i));
	if(options_div) {
		if(document.getElementById('checkbox-setum'+String(i)).checked) {
			options_div.style.display = "inherit";
		} else {
			options_div.style.display = "none";
		}
	}
}

function EnvChanged() {
	var SI=parseInt(document.getElementById('select-sources').selectedIndex);
	
	options_div=document.getElementById('div-options');
	  options_div.innerHTML="";
	  var SS=parseInt(document.getElementById('select-sources').selectedIndex);
	  for(var i = 0; i < dataset.settings.length; i++) {
		options_div.innerHTML=options_div.innerHTML+GetSettingsHtml(dataset.settings[i], false, String(i));
      }
	
	options_div=document.getElementById('div-details');
	options_div.innerHTML="";
	for(var i = 0; i < dataset.details.length; i++) {
		options_div.innerHTML=options_div.innerHTML+GetSettingsHtml(dataset.details[i], false, "Det"+String(i));
      }
	  
	options_div=document.getElementById('div-hacks');
	options_div.innerHTML="";
	for(var i = 0; i < dataset.hacks.length; i++) {
	
		var stri="Hack"+String(i);
		var setting = dataset.hacks[i];
		
		var retval='<div class="row row-cols-auto"><div class="col mb-1"><div class="form-check"><input class="form-check-input" type="checkbox" id="checkbox-set'+stri+'" name="option-set'+stri+'" value="something" onchange="GenerateEnvText();">  <label class="form-check-label">'+setting.name+'</label></div></div></div>';
		
		options_div.innerHTML=options_div.innerHTML+retval; //GetSettingsHtml(dataset.hacks[i], false, "Hack"+String(i));
    }
	
	options_div=document.getElementById('div-usermods');
	  options_div.innerHTML="";
	  var SS=parseInt(document.getElementById('select-sources').selectedIndex);
	  for(var i = 0; i < dataset.usermods.length; i++) {
		if(dataset.usermods[i].type=="checkbox" && dataset.usermods[i].sources.includes(SS)) {
			prefix = '<div class="row row-cols-auto"><div class="col mb-1"><div class="form-check"><input class="form-check-input" type="checkbox" id="checkbox-setum'+String(i)+'" name="option-setum'+String(i)+'" value="something" onchange="ChangeVisibilityUsermodOptions('+String(i)+');GenerateEnvText();">  <label class="form-check-label-um">'+dataset.usermods[i].name+'   <a href="'+dataset.usermods[i].readme+'" target="_blank">README</a></label><div id="UMOptionsList'+String(i)+'" style="display:none">';
			
			middlepart='';
			if("options" in dataset.usermods[i]) {
				for(var j = 0; j < dataset.usermods[i].options.length; j++) {
					middlepart=middlepart+GetSettingsHtml(dataset.usermods[i].options[j], true, 'UMopt'+String(i)+'_'+String(j))
				}
			}
			postfix = '</div></div></div></div>';
			options_div.innerHTML=options_div.innerHTML+prefix+middlepart+postfix;
		}
      }
	var obj = TestIni();
	//PioEnvInfo=document.getElementById('PioEnvInfo');
	PioEnvInfoText=document.getElementById('PioEnvInfoText');
	PioEnvInfoText.innerHTML="";
	SE=document.getElementById('select-enviroments');
	SEI=SE.selectedIndex;
	for(var key of Object.keys(obj)) {
		if (typeof obj[key] === 'object' && !Array.isArray(obj[key]) && obj[key] !== null && key=="env:"+SE.options[SEI].getAttribute("env")) {	
			for(var key1 of Object.keys(obj[key])) {
				//PioEnvInfo.innerHTML=PioEnvInfo.innerHTML+key1+" = " + String(obj[key][key1])+"\n";
			}
				if(obj[key].hasOwnProperty("board")) {
					key1="board";
					if(PioEnvInfoText.innerHTML!="") PioEnvInfoText.innerHTML=PioEnvInfoText.innerHTML+"<br>";
					PioEnvInfoText.innerHTML=PioEnvInfoText.innerHTML+"<b>Board definition</b> : "+String(obj[key][key1])+"&nbsp;&nbsp;(Definition ";
					
					if(obj[key].hasOwnProperty("build_flags") && obj[key]["build_flags"].includes("ARDUINO_ARCH_ESP32")) {
						PioEnvInfoText.innerHTML=PioEnvInfoText.innerHTML+"<a target='_blank' href='https://docs.platformio.org/en/latest/boards/espressif32/"+String(obj[key][key1])+".html'>here</a>)"
					} else {
						PioEnvInfoText.innerHTML=PioEnvInfoText.innerHTML+"<a target='_blank' href='https://docs.platformio.org/en/latest/boards/espressif8266/"+String(obj[key][key1])+".html'>here</a>)"
					}
					board_ext="";
					for(var key2 of Object.keys(obj[key])) {
						//PioEnvInfo.innerHTML=PioEnvInfo.innerHTML+key1+" = " + String(obj[key][key1])+"\n";
						if(key2.includes("board_build") || key2.includes("board_upload")) {
							if(board_ext!="") board_ext=board_ext+"<br>";
							board_ext=board_ext+"&nbsp;&nbsp;"+key2+" = "+obj[key][key2];
						}
					}
					if(board_ext!="") PioEnvInfoText.innerHTML=PioEnvInfoText.innerHTML+"<br><b>Board modifications</b> :<br>"+board_ext;
				}
				if(obj[key].hasOwnProperty("build_flags")) {
					key1="build_flags";
					if(PioEnvInfoText.innerHTML!="") PioEnvInfoText.innerHTML=PioEnvInfoText.innerHTML+"<br>";
					PioEnvInfoText.innerHTML=PioEnvInfoText.innerHTML+"<b>Build flags/options</b> :"
					str1=String(obj[key][key1]);
					split1=str1.split(" -");
					for (var s1 of split1) {
						if(s1.substr(1).trim()!="" && s1.trim()[0]=="D") {
							PioEnvInfoText.innerHTML=PioEnvInfoText.innerHTML+"<br>&nbsp;&nbsp;"+s1.substr(1).trim()+"";
						}
					}
				}
				if(obj[key].hasOwnProperty("lib_deps")) {
					key1="lib_deps";
					if(PioEnvInfoText.innerHTML!="") PioEnvInfoText.innerHTML=PioEnvInfoText.innerHTML+"<br>";
					PioEnvInfoText.innerHTML=PioEnvInfoText.innerHTML+"<b>Libraries included</b> :"
					str1=String(obj[key][key1]);
					split1=str1.split(" ");
					for (var s1 of split1) {
						if(s1.trim()!="") {
							PioEnvInfoText.innerHTML=PioEnvInfoText.innerHTML+"<br>&nbsp;&nbsp;"+s1.trim()+"";
						}
					}
				}
		}
	}
	GenerateEnvText();
}

function LoadDataset() {
  const xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      dataset = JSON.parse(this.responseText);
	  sel=document.getElementById('select-sources');
      for(var i = 0; i < dataset.sources.length; i++) {
	    if(dataset.sources[i].custom==0) {
			var opt = document.createElement('option');
			opt.value = i;
			opt.innerHTML = dataset.sources[i].name;
			opt.setAttribute("ghusername",dataset.sources[i].githubusername);
			opt.setAttribute("ghreponame",dataset.sources[i].githubreponame);
			opt.setAttribute("custom",dataset.sources[i].custom);
			opt.setAttribute("recommendedbranch",dataset.sources[i].recommendedbranch);
			opt.setAttribute("recommended_esp8266",dataset.sources[i].recommended_esp8266);
			opt.setAttribute("recommended_esp32",dataset.sources[i].recommended_esp32);
			sel.appendChild(opt);
		}
      }
	  SourceChanged();	  
    }
  };
  xhttp.open("GET", "dataset.json");
  xhttp.send(); 
}

function GetFlagsAndDepsForSetting(setting, stri) {
	var buildflags="";
	var libdeps="";
	
	if(document.getElementById('checkbox-set'+stri).checked) {
		if(String(setting.build_flags).length>0) {
		buildflags=buildflags+" "+setting.build_flags;
			if(setting.type=="number" || setting.type=="number_float") {
				numval=String(document.getElementById('input-number-'+stri).value);
				if(numval.length==0) {
					numval="0";
				}
				if(setting.type=="number_float") {
					if(numval.indexOf(".")>-1) {
						numval=numval+"f";
					} else {
						numval=numval+".f";
					}
				}
				buildflags=buildflags+numval;
			}
			if(setting.type=="string") {
				stringval=String(document.getElementById('input-string-'+stri).value);
				buildflags=buildflags+"'\""+stringval+"\"'";
			}
			if(setting.type=="defparam") {
				stringval=String(document.getElementById('input-string-'+stri).value);
				buildflags=buildflags+stringval;
			}
		}
		if(String(setting.lib_deps).length>0) {
			libdeps=libdeps+"\n  "+setting.lib_deps;
		}
	}
	
	return [buildflags, libdeps];
}

function GetLinesForDetail(setting, stri) {
	var newline="";
	
	if(document.getElementById('checkbox-set'+stri).checked) {
		newline="\n"+setting.line;
		if(setting.type=="number" || setting.type=="number_float") {
			numval=String(document.getElementById('input-number-'+stri).value);
			if(numval.length==0) {
				numval="0";
			}
			if(setting.type=="number_float") numval=numval+"f";
			newline=newline+numval;
		}
		if(setting.type=="string") {
			stringval=String(document.getElementById('input-string-'+stri).value);
			newline=newline+"'\""+stringval+"\"'";
		}
		if(setting.type=="defparam") {
			stringval=String(document.getElementById('input-string-'+stri).value);
			newline=newline+stringval;
		}
	}
	
	return newline;
}

function GenerateEnvText() {
	envtextfield=document.getElementById('env-text');
	SS=document.getElementById('select-sources')
	SSI=SS.selectedIndex;
	SE=document.getElementById('select-enviroments');
	SEI=SE.selectedIndex;

	var value="[env:custom_build]\nextends = env:"+SE.options[SEI].getAttribute("env");

	for(var i = 0; i < dataset.details.length; i++) {
			if((dataset.details[i].type=="checkbox" || dataset.details[i].type=="number" || dataset.details[i].type=="number_float" || dataset.details[i].type=="string"  || dataset.details[i].type=="defparam") && dataset.details[i].sources.includes(SSI)) {
			// ("value_list" in dataset.details[i] && Object.keys(dataset.details[i]).length>0)
				newline = GetLinesForDetail(dataset.details[i], "Det"+String(i));
				value=value+newline;
			}

		}

	var buildflags="";
	var libdeps="";
	var buildunflags="";

	for(var i = 0; i < dataset.settings.length; i++) {
		if((dataset.settings[i].type=="checkbox" || dataset.settings[i].type=="number" || dataset.settings[i].type=="number_float" || dataset.settings[i].type=="string"  || dataset.settings[i].type=="defparam") && dataset.settings[i].sources.includes(SSI)) {
			[buildflags_add, libdeps_add] = GetFlagsAndDepsForSetting(dataset.settings[i], String(i));
			buildflags=buildflags+buildflags_add;
			libdeps=libdeps+libdeps_add;
		}

	}
	
	for(var i = 0; i < dataset.usermods.length; i++) {
		if(dataset.usermods[i].type=="checkbox" && dataset.usermods[i].sources.includes(SSI)) {
			if(document.getElementById('checkbox-setum'+String(i)).checked) {
				if(String(dataset.usermods[i].build_flags).length>0) {
					buildflags=buildflags+" "+dataset.usermods[i].build_flags;
				}
				if("build_unflags" in dataset.usermods[i] && String(dataset.usermods[i].build_unflags).length>0) {
					buildunflags=buildunflags+" "+dataset.usermods[i].build_unflags;
				}
				if(String(dataset.usermods[i].lib_deps).length>0) {
					libdeps=libdeps+"\n  "+dataset.usermods[i].lib_deps;
				}
				if("options" in dataset.usermods[i]) {
					for(var j = 0; j < dataset.usermods[i].options.length; j++) {
						[buildflags_add, libdeps_add] = GetFlagsAndDepsForSetting(dataset.usermods[i].options[j], 'UMopt'+String(i)+'_'+String(j));
						buildflags=buildflags+buildflags_add;
						libdeps=libdeps+libdeps_add;
					}
				}
			}
		}
	}
	
	if(String(buildflags).length>0) {
		value=value+"\nbuild_flags = ${env:"+SE.options[SEI].getAttribute("env")+".build_flags}"+buildflags;
	}
	if(String(buildunflags).length>0) {
		value=value+"\nbuild_unflags = "+buildunflags;
	}
	if(String(libdeps).length>0) {
		value=value+"\nlib_deps = \n  ${env:"+SE.options[SEI].getAttribute("env")+".lib_deps}"+libdeps;
	}
	
envtextfield.value=value;
}

function LangChanged() {
    if(document.getElementById('lang').selectedIndex==0) {
		if(document.getElementById('L01')) document.getElementById('L01').innerHTML = "Quelle der WLED SW auswählen (Abzweigung):";
		if(document.getElementById('L02')) document.getElementById('L02').innerHTML = "Branch / Release auswählen:";
		if(document.getElementById('L03')) document.getElementById('L03').innerHTML = "Mikrocontroller Typ auswählen:";
		if(document.getElementById('L04')) document.getElementById('L04').innerHTML = "Optionen:";
		if(document.getElementById('L05')) document.getElementById('L05').innerHTML = "UserMods verwenden (ggf. max Anzahl von usermods oben in Optionen anpassen!):";
		if(document.getElementById('L06')) document.getElementById('L06').innerHTML = "Schritt 4: Prüfe generierte Konfiguration (ignoriere, wenn Du nicht weiss was das ist):";
		if(document.getElementById('L07')) document.getElementById('L07').innerHTML = 'Kompiliere Dir eigene WLED Software online mit nur wenigen Klicks!'
		if(document.getElementById('L18')) document.getElementById('L18').innerHTML = 'Impressum';
        if(document.getElementById('L20')) document.getElementById('L20').innerHTML = 'Datenschutzerklärung';
		if(document.getElementById('L19')) document.getElementById('L19').innerHTML =  "<br><h3>Impressum</h3>Verantwortlicher: Wladislaw Waag<br>Adresse: Wasserburger Landstr. 29, 81825 München, Deutschland<br>Kontakt: +49 (0) 176 47 11 5206, info@myhome-control.de<br><br>EU-Streitschlichtung: Die Europäische Kommission stellt eine Plattform zur Online-Streitbeilegung (OS) bereit: <a href='https://ec.europa.eu/consumers/odr/' target='_blank'>https://ec.europa.eu/consumers/odr/</a>.<br><br>Verbraucherstreitbeilegung/Universalschlichtungsstelle: Wir sind nicht bereit oder verpflichtet, an Streitbeilegungsverfahren vor einer Verbraucherschlichtungsstelle teilzunehmen.";
		if(document.getElementById('L21')) document.getElementById('L21').innerHTML = "<br><h3>Datenschutzerklärung</h3> Diese Seite wird im Rahmen von 'Github Pages' gehostet und betrieben. Es ist möglich und wahrscheinlich, dass Github Ihre personenbezogenen Daten sammelt und verarbeitet. Das betrifft dann auch die Besucher der Webseite wled-compile.github.io. Wir haben aber keinerlei Einfluss darauf. Bitte lesen Sie dazu die Datenschutzerklärung von Github: <a href='https://docs.github.com/en/github/site-policy/github-privacy-statement' target='_blank'>https://docs.github.com/en/github/site-policy/github-privacy-statement</a><br><br>Außerdem sobald Sie mit Kompilieren starten, werden Ihre IP Adresse sowie alle von Ihnen eingegebenen Daten an https://myhome-control.de weitergeleitet. Das ist für die Ausführung des Auftrags zwingend notwendig. Die Datenschutzerklärung dazu finden Sie unter <a href=‘https://shop.myhome-control.de/Information/Datenschutz/‘>https://shop.myhome-control.de/Information/Datenschutz/</a><br><br>Unsere Webseite enthält Links zu externen Webseiten Dritter, auf deren Inhalte wir keinen Einfluss haben. Für diese fremden Inhalte können wir keine Gewähr und keine Haftung übernehmen. Für die Inhalte der verlinkten Seiten ist immer der jeweilige Anbieter oder Betreiber der Seiten verantwortlich. Die verlinkten Seiten wurden zum Zeitpunkt der Verlinkung auf mögliche Rechtsverstöße überprüft. Rechtswidrige Inhalte waren dabei nicht erkennbar. Sollten uns Rechtsverletzungen bekannt werden, werden wir die entsprechende Verlinkung umgehend entfernen.";
		if(document.getElementById('L14a')) document.getElementById('L14a').innerHTML = 'Offizielle WLED Wiki (Englisch): ';
		if(document.getElementById('L14f')) document.getElementById('L14f').innerHTML = 'WLED FAQ: <a href="https://wled-faq.github.io">https://wled-faq.github.io</a>';
		if(document.getElementById('L14b')) document.getElementById('L14b').innerHTML = 'DIY WLED Boards:';
        if(document.getElementById('L14c')) document.getElementById('L14c').innerHTML = 'Professionelle WLED Controller: <a href="https://shop.myhome-control.de">MyHome-Control Shop</a>';
        if(document.getElementById('L14d')) document.getElementById('L14d').innerHTML = 'WEB-basierter WLED Software Installer: ';
		if(document.getElementById('L14e')) document.getElementById('L14e').innerHTML = 'WLED power calculator: ';
		if(document.getElementById('L14')) document.getElementById('L14').innerHTML = "Nützliche Informationen:";
		if(document.getElementById('L22')) document.getElementById('L22').innerHTML = "Kompilieren starten";
		if(document.getElementById('L25')) document.getElementById('L25').innerHTML = '(alter compile helper hier: ';
		if(document.getElementById('L26')) document.getElementById('L26').innerHTML = 'Deine GitHub Account Name';
		if(document.getElementById('L27')) document.getElementById('L27').innerHTML = 'Deine GitHub Repository';
		if(document.getElementById('L30')) document.getElementById('L30').innerHTML = 'Schritt 1: WLED Software / Release / Controller-Typ auswählen';
		if(document.getElementById('L31')) document.getElementById('L31').innerHTML = 'Schritt 2: Optionen wählen';
		if(document.getElementById('L32')) document.getElementById('L32').innerHTML = 'Schritt 3: UserMods auswählen';
		if(document.getElementById('L33')) document.getElementById('L33').innerHTML = 'Schritt 5: Kompilieren starten und nach Abschluss SW herunterladen';
		if(document.getElementById('L34')) document.getElementById('L34').innerHTML = 'Ergebnisse zum Herunterladen:';
		if(document.getElementById('L35')) document.getElementById('L35').innerHTML = 'Achtung: Bitte geben Sie bei der Konfiguration der WLED SW keine personenbezogenen Daten (Name etc.) und keine geheimen Informationen (Passwörter etc.) ein! Das kompilieren erfolgt auf öffentlich zugänglichen Servern, so dass jeder die von Ihnen eingegebenen Informationen einsehen kann!';
		if(document.getElementById('L36')) document.getElementById('L36').innerHTML = 'Diese Software ist open source und wird kostenfrei zur Verfügung gestellt. Es werden keine bestimmten Eigenschaften der Software zugesichert. Der Inhaber dieser Webseite haftet nur für Vorsatz und grobe Fahrlässigkeit. Gewährleistungspflichten treffen ihn nur, wenn er Mängel der Software arglistig verschwiegen hat.';
		if(document.getElementById('L37')) document.getElementById('L37').innerHTML = 'Bitte beachten Sie die Software Lizenzen: <a href="https://wled-install.github.io/WLED_Software_Lizenzen.pdf">WLED licenses</a>';
		if(document.getElementById('L23x')) document.getElementById('L23x').innerHTML = 'Vorgehensweise:';
		if(document.getElementById('L01x')) document.getElementById('L01x').innerHTML = "Schliessen Sie Ihr ESP8266 / ESP32 Board an USB an.";
        if(document.getElementById('L03x')) document.getElementById('L03x').innerHTML = "Klicken Sie auf \"Installieren\" und wählen dann den korrekten COM-Port aus. ";
        if(document.getElementById('L04x')) document.getElementById('L04x').innerHTML = "Kein Board wurde gefunden?";
        if(document.getElementById('L05x')) document.getElementById('L05x').innerHTML = "Klicken Sie auf \"Install WLED\". Die Installation beginnt. Sollte nach einiger Zeit die Installation beim \"Wrapping Up\" stehen bleiben, können sie es unterbrechen. Die SW ist dann trotzdem i.O. installiert.";
        if(document.getElementById('L09x')) document.getElementById('L09x').innerHTML = "Installieren";
		if(document.getElementById('L38')) document.getElementById('L38').innerHTML = "Schritt 6: Kompilierte SW direkt über USB installieren (optionall)";
	    if(document.getElementById('L28x')) document.getElementById('L28x').innerHTML = "ESP32-S2 wie lolin_mini etc.: WEB installer funktioniert aktuell nicht";
		if(document.getElementById('L30a')) document.getElementById('L30a').innerHTML = "Schritt 1a (optional, für Fortgeschrittene): ändere Compiler/Builder Details";
		if(document.getElementById('L30b')) document.getElementById('L30b').innerHTML = "Schritt 1b (optional, für Fortgeschrittene): verwende spezielle hacks/tweaks";
		if(document.getElementById('L39')) document.getElementById('L39').innerHTML = "Information über die Definitionen für das gewählte Controller Typ:";
		
	} else {
		if(document.getElementById('L01')) document.getElementById('L01').innerHTML = "Select WLED source (fork):";
		if(document.getElementById('L02')) document.getElementById('L02').innerHTML = "Select branch/release:";
		if(document.getElementById('L03')) document.getElementById('L03').innerHTML = "Select microcontroller type:";
		if(document.getElementById('L04')) document.getElementById('L04').innerHTML = "Options:";
		if(document.getElementById('L05')) document.getElementById('L05').innerHTML = "Include usermods (please eventually change max. number of usermods under Options above):";
		if(document.getElementById('L06')) document.getElementById('L06').innerHTML = "Step 4: check generated configuration (ignore if you don't know what this is):";
		if(document.getElementById('L07')) document.getElementById('L07').innerHTML = 'Compile your own WLED software online with just few clicks!';
	    if(document.getElementById('L18')) document.getElementById('L18').innerHTML = 'Legal notice';
        if(document.getElementById('L20')) document.getElementById('L20').innerHTML = 'Data privacy';
		if(document.getElementById('L19')) document.getElementById('L19').innerHTML =  "<br><h3>Legal notice</h3>Responsible: Wladislaw Waag<br>Address: Wasserburger Landstr. 29, 81825 Munich, Germany<br>Contact: +49 176 47 11 5206, info@myhome-control.de<br><br>EU dispute settlement: The European Commission provides a platform for online dispute resolution (ODR): <a href='https://ec.europa.eu/consumers/odr/' target='_blank'>https://ec.europa.eu/consumers/odr/</a>.<br><br>Consumer dispute settlement / universal arbitration board: We are neither willing nor obliged to participate in dispute settlement proceedings before a consumer arbitration board.";
		if(document.getElementById('L21')) document.getElementById('L21').innerHTML = "<br><h3>Data privacy</h3>This page is hosted and operated as part of 'Github Pages'. It is possible and probable that Github collects and processes personal data, which then also affects visitors of the wled-compile.github.io web page. We have, however, no influence on it. Please read the Github privacy statement: <a href='https://docs.github.com/en/github/site-policy/github-privacy-statement' target='_blank'>https://docs.github.com/en/github/site-policy/github-privacy-statement</a><br><br>In addition, as soon as you start compiling, your IP address and all the data you entered forwarded to https://myhome-control.de. This is absolutely necessary for the execution of the order. The data protection declaration can be found at <a href=‘ https://shop.myhome-control.de/en/Information/Data-privacy/> https://shop.myhome-control.de/en/Information/Data-privacy/</a><br><br>Our website contains links to external websites over which we have no control. We cannot accept any liability for this third-party content. The respective provider or operator of the pages is always responsible for the content of the linked pages. The linked pages were checked for possible legal violations at the time of linking. Illegal content was not recognizable at that time. If we become aware of any legal violations, we will remove the relevant link immediately.";
		if(document.getElementById('L14a')) document.getElementById('L14a').innerHTML = 'Official WLED Wiki: ';
		if(document.getElementById('L14f')) document.getElementById('L14f').innerHTML = 'WLED FAQ: <a href="https://wled-faq.github.io">https://wled-faq.github.io</a>';
		if(document.getElementById('L14b')) document.getElementById('L14b').innerHTML = 'DIY WLED Boards:';
        if(document.getElementById('L14c')) document.getElementById('L14c').innerHTML = 'Professional WLED Controllers: <a href="https://shop.myhome-control.de">MyHome-Control Shop</a>';
        if(document.getElementById('L14d')) document.getElementById('L14d').innerHTML = 'WEB-based WLED software installer: ';
		if(document.getElementById('L14e')) document.getElementById('L14e').innerHTML = 'WLED power calculator: ';
		if(document.getElementById('L14')) document.getElementById('L14').innerHTML = "Useful links: ";
		if(document.getElementById('L22')) document.getElementById('L22').innerHTML = "start compile/build";

		if(document.getElementById('L25')) document.getElementById('L25').innerHTML = '(old compile helper here: ';
		if(document.getElementById('L26')) document.getElementById('L26').innerHTML = 'Your GitHub account name';
		if(document.getElementById('L27')) document.getElementById('L27').innerHTML = 'Your GitHub repository';
		if(document.getElementById('L30')) document.getElementById('L30').innerHTML = 'Step 1: select WLED software / release / controller type';
		if(document.getElementById('L31')) document.getElementById('L31').innerHTML = 'Step 2: select options';
		if(document.getElementById('L32')) document.getElementById('L32').innerHTML = 'Step 3: select usermods';
		if(document.getElementById('L33')) document.getElementById('L33').innerHTML = 'Step 5: start compiling and download SW when finished';
		if(document.getElementById('L34')) document.getElementById('L34').innerHTML = 'Results to download:';
		if(document.getElementById('L35')) document.getElementById('L35').innerHTML = 'Attention: Please do not enter any personal data (name etc.) or secret information (passwords etc.) when configuring the WLED SW! Compiling takes place on publicly accessible servers so that everyone can see the information you enter!';
		if(document.getElementById('L36')) document.getElementById('L36').innerHTML = 'This is open source software and is provided for free. It is provided "as is", without warranty of any kind, express or implied, including but not limited to the warranties of merchantability, fitness for a particular purpose and noninfringement. In no event shall the owner of this web page be liable for any claim, damages or other liability, whether in an action of contract, tort or otherwise, arising from, out of or in connection with the software or the use or other dealings in the software. The exeption are cases defined by the law. In case German law should be applied, the German version of this disclaimer must be used (please select German language above).';
		if(document.getElementById('L37')) document.getElementById('L37').innerHTML = 'Bitte beachten Sie die Software Lizenzen: <a href="https://wled-install.github.io/WLED_Software_Lizenzen.pdf">WLED licenses</a>';
		if(document.getElementById('L23x')) document.getElementById('L23x').innerHTML = 'Steps:';
		if(document.getElementById('L01x')) document.getElementById('L01x').innerHTML = "Connect your ESP8266 / ESP32 board via USB port.";
        if(document.getElementById('L03x')) document.getElementById('L03x').innerHTML = "Click on \"Install\" and select the correct COM port. ";
        if(document.getElementById('L04x')) document.getElementById('L04x').innerHTML = "No board found?";
        if(document.getElementById('L05x')) document.getElementById('L05x').innerHTML = "Click on \"Install WLED\". If after some time the installation stops at \"wrapping up\", you can interrupt it. The SW is then already installed correctly.";
        if(document.getElementById('L09x')) document.getElementById('L09x').innerHTML = "Install";
		if(document.getElementById('L38')) document.getElementById('L38').innerHTML = "Step 6: install compiled SW directly via USB (optionally)";
	    if(document.getElementById('L28x')) document.getElementById('L28x').innerHTML = "ESP32-S2 such as lolin_mini etc.: WEB installer presently does not work";
		if(document.getElementById('L30a')) document.getElementById('L30a').innerHTML = "Step 1a (optionally, for advanced users): change compile/build details";
		if(document.getElementById('L30b')) document.getElementById('L30b').innerHTML = "Step 1b (optionally, for advanced users): apply special hacks/tweaks";
		if(document.getElementById('L39')) document.getElementById('L39').innerHTML = "Information about the selected controller type definitions:";
	}
    if(document.getElementById('lang').selectedIndex==0) {
		document.getElementById('result_line1').innerHTML='Status: <span style="color:green">noch nicht gestartet</span>';
		document.getElementById('result_line2').innerHTML='Download-Link zum Ergebnis: <span style="color:green">noch kein</span>';
		document.getElementById("carousel1").style.display = "block";
	} else {
		document.getElementById('result_line1').innerHTML='State: <span style="color:green">not started yet</span>';
		document.getElementById('result_line2').innerHTML='Download link for the result: <span style="color:green">nothing yet</span>';
		document.getElementById("carousel1").style.display = "none";
	}
	if(document.getElementById('comporthelp')) {
		if(document.getElementById('comporthelp').innerHTML!="") NoComPortHelp();
	}
	if(document.getElementById('newtypeshelp')) {
		if(document.getElementById('newtypeshelp').innerHTML!="") NewTypesHelp();
	}
}

// $$WLEDPATH$$ Path to zipped source
// echo " " >> platformio.ini
// pio run -e esp32dev || pio run -e esp32dev || true
// $$WLEDPIORUN$$

var generator_state='waiting';
var idreturned='';
var datereturned='';
var wait_cycle_counter=0;
var wait_counter=0;

function GeneratorJob() {

	if(generator_state=='start') {
		SS=document.getElementById('select-sources');
		SSI=SS.selectedIndex;
		SB=document.getElementById('select-branches');
		SBI=SB.selectedIndex;
		
		var hacks="";
		for(var i = 0; i < dataset.hacks.length; i++) {
			if(document.getElementById('checkbox-setHack'+String(i)).checked) {
				if(hacks!="") {
					hacks=hacks+";";
				}
				hacks=hacks+String(dataset.hacks[i].id);
			}
		}
		
		if(hacks!="") {
			hacks="&hacks="+encodeURIComponent(hacks);
		}
		
		var mReq = new XMLHttpRequest();
		console.log(encodeURIComponent(SB.options[SBI].getAttribute("url")));
		mReq.open('POST', 'https://can-gateway.myhome-control.de/api/gate_post2.php?repo='+encodeURIComponent(SB.options[SBI].getAttribute("url").replace("https://","").replace("http://",""))+hacks);
		mReq.setRequestHeader('Content-type', 'text/plain');
		mReq.onreadystatechange = function () { 
		  if (mReq.readyState === 4 && this.status == 200 && generator_state=='waitforid') {
			var resp=mReq.responseText;
			if(resp.length!=20+1+8) {
			  //alert("Error returned!");
			  idreturned='';
			  datereturned='';
			  generator_state='interrupted';
			  if(document.getElementById('lang').selectedIndex==0) {
					document.getElementById('result_line1').innerHTML='Status: <span style="color:red">Abgebrochen! versuchen Sie erneut!</span>';
					document.getElementById('result_line2').innerHTML='Download-Link zum Ergebnis: <span style="color:red">kein</span>';
				} else {
					document.getElementById('result_line1').innerHTML='State: <span style="color:red">Interrupted!... please try again!</span>';
					document.getElementById('result_line2').innerHTML='Download link for the result: <span style="color:red">nothing</span>';
				}
			  document.getElementById("spinner").style.visibility = "hidden";
			} else {
				//alert("ID returned: "+resp);
				
				datereturned=resp.split(";")[0];
				idreturned=resp.split(";")[1];
				wait_cycle_counter=0;
				generator_state='waitforbuildfinish';
				if(document.getElementById('lang').selectedIndex==0) {
					document.getElementById('result_line1').innerHTML='Status: <span style="color:orange">job wird ausgeführt ... bitte warten und die Seite NICHT neu laden ... es dauert gewöhnlich 5 is 10 Minuten</span>';
					document.getElementById('result_line2').innerHTML='Download-Link zum Ergebnis: <span style="color:orange">noch kein</span>';
				} else {
					document.getElementById('result_line1').innerHTML='State: <span style="color:orange">job is being executed... please wait and DO NOT reload this page ... it takes 5 to 10 minutes usually</span>';
					document.getElementById('result_line2').innerHTML='Download link for the result: <span style="color:orange">nothing yet</span>';
				}
			}
			
		  }
		};
		generator_state='waitforid';
		if(document.getElementById('lang').selectedIndex==0) {
			document.getElementById('result_line1').innerHTML='Status: <span style="color:orange">job wird angefragt ... bitte warten und die Seite NICHT neu laden ... es dauert gewöhnlich 5 is 10 Minuten</span>';
			document.getElementById('result_line2').innerHTML='Download-Link zum Ergebnis: <span style="color:orange">noch kein</span>';
		} else {
			document.getElementById('result_line1').innerHTML='State: <span style="color:orange">job is requested ... please wait and DO NOT reload this page ... it takes 5 to 10 minutes usually</span>';
			document.getElementById('result_line2').innerHTML='Download link for the result: <span style="color:orange">nothing yet</span>';
		}
		mReq.send(document.getElementById('env-text').value.replaceAll("\n","\\n"));
	}
	if(generator_state=='waitforbuildfinish') {
		if(wait_counter>=10) {
			wait_cycle_counter=wait_cycle_counter+1;
			if(wait_cycle_counter>120) {
				generator_state='interrupted';
				if(document.getElementById('lang').selectedIndex==0) {
					document.getElementById('result_line1').innerHTML='Status: <span style="color:red">Abgebrochen wegen Timeout! Versuchen Sie erneut!</span>';
					document.getElementById('result_line2').innerHTML='Download-Link zum Ergebnis: <span style="color:red">kein</span>';
				} else {
					document.getElementById('result_line1').innerHTML='State: <span style="color:red">Interrupted / timeout!... please try again!</span>';
					document.getElementById('result_line2').innerHTML='Download link for the result: <span style="color:red">nothing</span>';
				}
				document.getElementById("spinner").style.visibility = "hidden";
			} else {
				var mReq = new XMLHttpRequest();
				mReq.open('GET', 'https://raw.githubusercontent.com/wled-compile1/myrepo1/refs/heads/main/'+datereturned+'/'+idreturned+'/log.txt');
				mReq.onreadystatechange = function () { 
				  if (mReq.readyState === 4 && this.status == 200 && generator_state=='waitforbuildfinish') {
					generator_state='buildfinished';
					linktofile='https://raw.githubusercontent.com/wled-compile1/myrepo1/refs/heads/main/'+datereturned+'/'+idreturned+'/log.txt';
					if(document.getElementById('lang').selectedIndex==0) {
						document.getElementById('result_line1').innerHTML='Status: <span style="color:green">Abgeschlossen!</span>';
						document.getElementById('result_line2').innerHTML='Bin-Datei: <span style="color:green">... wird generiert ...</span>';
						document.getElementById('result_line3').innerHTML='Download-Link zu Log-Datei: <a href="'+linktofile+'" target="_blank">log.txt</a>';
					} else {
						document.getElementById('result_line1').innerHTML='State: <span style="color:green">Completed!</span>';
						document.getElementById('result_line2').innerHTML='Bin file: <span style="color:green">... being generated ...</span>';
						document.getElementById('result_line3').innerHTML='Download link for the logging file: <a href="'+linktofile+'" target="_blank">log.txt</a>';
					}
					var mReq1 = new XMLHttpRequest();
					mReq1.open('GET', 'https://raw.githubusercontent.com/wled-compile1/myrepo1/refs/heads/main/'+datereturned+'/'+idreturned+'/wled.bin');
					mReq1.onreadystatechange = function () { 
						if (mReq.readyState === 4 && this.status == 200 && generator_state=='buildfinished') {
							generator_state='finished';
							if(document.getElementById('lang').selectedIndex==0) {
								document.getElementById('result_line2').innerHTML='Bin-Datei: <a href="'+'https://raw.githubusercontent.com/wled-compile1/myrepo1/refs/heads/main/'+datereturned+'/'+idreturned+'/wled.bin'+'" download>wled.bin</a>';
							} else {
								document.getElementById('result_line2').innerHTML='Bin file: <a href="'+'https://raw.githubusercontent.com/wled-compile1/myrepo1/refs/heads/main/'+datereturned+'/'+idreturned+'/wled.bin'+'" download>wled.bin</a>';
							}
							document.getElementById("spinner").style.visibility = "hidden";
							
							manifest_file = 'https://raw.githubusercontent.com/wled-compile1/myrepo1/refs/heads/main/'+datereturned+'/'+idreturned+'/manifest_file.json';
							if(document.getElementById('install_btn')) document.getElementById('install_btn').setAttribute('manifest',manifest_file);
							if(document.getElementById("InstallButton")) document.getElementById("InstallButton").disabled = false;
						}
						if (mReq.readyState === 4 && this.status == 404 && generator_state=='buildfinished') {
							generator_state='interrupted';
							if(document.getElementById('lang').selectedIndex==0) {
								document.getElementById('result_line2').innerHTML='Bin-Datei: <span style="color:red">Fehler! Siehe Log Datei</span>';
							} else {
								document.getElementById('result_line2').innerHTML='Bin file: <span style="color:red">Error! Please check log file</span>';
							}
							document.getElementById("spinner").style.visibility = "hidden";
						}
					};
					mReq1.send();
				  }
				};
				mReq.send();
				
			}
			wait_counter=0;
		} else {
			wait_counter=wait_counter+1;
		}
	}

}

function StartBuildOnline() {
	if(generator_state=='waiting' || generator_state=='interrupted' || generator_state=='finished') {
		// start
		generator_state='start';
		if(document.getElementById("InstallButton")) document.getElementById("InstallButton").disabled = true;
		if(document.getElementById('lang').selectedIndex==0) {
			document.getElementById('result_line1').innerHTML='Status: <span style="color:orange">gestartet ... bitte warten und die Seite NICHT neu laden ... es dauert gewöhnlich 5 is 10 Minuten</span>';
			document.getElementById('result_line2').innerHTML='Download-Link zum Ergebnis: <span style="color:orange">noch kein</span>';
		} else {
			document.getElementById('result_line1').innerHTML='State: <span style="color:orange">started ... please wait and DO NOT reload this page ... it takes 5 to 10 minutes usually</span>';
			document.getElementById('result_line2').innerHTML='Download link for the result: <span style="color:orange">nothing yet</span>';
		}
		document.getElementById('result_line3').innerHTML='';
		var interval = setInterval(function() {GeneratorJob();}, 1000);
		document.getElementById("spinner").style.visibility = "visible";
	}
}

function NoComPortHelp() {
    document.getElementById('L04x').innerHTML = "";
    if(document.getElementById('lang').selectedIndex==0) {
        if(document.getElementById('comporthelp')) document.getElementById('comporthelp').innerHTML = "Ist Dein USB Kabel geeignet für Datentransfer ?<br>Vielelicht fehlt der USB Treiber für Dein Board. Die meisten Boards verwenden einen von diesen:<br>- <a href=\"https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers?tab=downloads\" target=\"_blank\">CP210x (quadratischer Chip)</a><br>-  <a href=\"http://www.wch-ic.com/downloads/CH341SER_EXE.html\" target=\"_blank\">CH34x (Rechteck Chip) oder CH9102x (quadratischer Chip)</a><br>";
    } else {
        if(document.getElementById('comporthelp')) document.getElementById('comporthelp').innerHTML = "Check if your USB cable supports data transfer.<br>Eventually you have to install the drivers for your board.<br>Here are drivers commonly used in ESP32 boards:<br>- <a href=\"https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers\" target=\"_blank\">CP210x (small square chip)</a><br>- <a href=\"http://www.wch-ic.com/downloads/CH341SER_EXE.html\" target=\"_blank\">CH34x (rectangular chip) or CH9102x (small square chip)</a><br>";
    }
}

function NewTypesHelp() {
    if(document.getElementById('lang').selectedIndex==0) {
        if(document.getElementById('newtypeshelp')) document.getElementById('newtypeshelp').innerHTML = "- Die Unterstützung für diese neue Typen ist noch hoch experimentell<br>- Zum Flashen immer erst den zweiten Taster (nicht den Reset!) auf dem Bord drücken und halten, erst dann ins USB einstecken. Dann den Taster loslassen<br>- Nach der Installation manuell resetten<br>- Es sind einige ESP32-C3 V1.0.0 Boards auf dem Markt, die grundsätzlich nicht funktionieren";
    } else {
        if(document.getElementById('newtypeshelp')) document.getElementById('newtypeshelp').innerHTML = "- The support for these new types is still highly experimental<br>- For flashing, first press and hold the second button (not the reset!) on the board before plugging it into the USB. Then release the button<br>- After installation do reset manually<br>- There are some ESP32-C3 V1.0.0 boards on the market that basically dont work";
    }
}

window.onload = function () {

	if (document.getElementById('install_btn').hasAttribute('install-unsupported')) {
        if(document.getElementById('lang').selectedIndex==0) {
            document.getElementById('InstallNoteContainer').innerHTML = "<span id=\"L10\">Leider wird Ihr Browser für die Installation über USB aktuell nicht unterstützt!<br>Bitte versuchen Sie mit Google Chrome (für Desktop) oder Microsoft Edge.";
        } else {
            document.getElementById('InstallNoteContainer').innerHTML = "<span id=\"L10\">Unfortunately your browser is not yet supported for installation via USB!<br>Please try on Chrome (for Desktop) or Microsoft Edge.";
        }
		document.getElementById('InstallContainer').innerHTML = "";
    } else {
		document.getElementById('InstallNoteContainer').innerHTML = "";
	}
	LoadDataset();
	LangChanged();
	document.getElementById("spinner").style.visibility = "hidden";
	if(document.getElementById("InstallButton")) document.getElementById("InstallButton").disabled = true;
};
</script>
<script
  type="module"
  src="https://unpkg.com/esp-web-tools@10/dist/web/install-button.js?module"
></script>
</body>
</html>
